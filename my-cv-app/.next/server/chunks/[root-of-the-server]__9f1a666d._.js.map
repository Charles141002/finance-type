{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 26, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/halca/finance-type/my-cv-app/utils/blocksToHTML.ts"],"sourcesContent":["import { Block } from \"./types\";\r\n\r\nfunction escapeHtml(input: string): string {\r\n  return input\r\n    .replace(/&/g, \"&amp;\")\r\n    .replace(/</g, \"&lt;\")\r\n    .replace(/>/g, \"&gt;\");\r\n}\r\n\r\nfunction renderSubsectionChildren(children: Block[] | undefined): string {\r\n  if (!children || children.length === 0) return \"\";\r\n\r\n  const htmlParts: string[] = [];\r\n  let currentListItems: string[] | null = null;\r\n\r\n  const flushList = () => {\r\n    if (currentListItems && currentListItems.length > 0) {\r\n      htmlParts.push(`<ul class=\"cv-list\">${currentListItems.join(\"\")}</ul>`);\r\n    }\r\n    currentListItems = null;\r\n  };\r\n\r\n  for (const child of children) {\r\n    if (child.type === \"text\") {\r\n      const raw = typeof child.content === \"string\" ? child.content : \"\";\r\n      const plain = raw.replace(/<[^>]*>/g, \"\");\r\n      const trimmed = plain.trim();\r\n      const isBullet = trimmed.startsWith(\"•\");\r\n      if (isBullet) {\r\n        const content = escapeHtml(trimmed.replace(/^•\\s*/, \"\"));\r\n        if (!currentListItems) currentListItems = [];\r\n        currentListItems.push(`<li>${content}</li>`);\r\n        continue;\r\n      }\r\n      // aucun bullet => flush puis paragraphe\r\n      flushList();\r\n      htmlParts.push(`<p class=\"cv-text\">${raw}</p>`);\r\n    } else if (child.type === \"divider\") {\r\n      flushList();\r\n      htmlParts.push(`<hr class=\"cv-hr\"/>`);\r\n    } else if (child.type === \"section\" || child.type === \"subsection\") {\r\n      // cas rare: sous-niveaux -> flush puis rendu normal récursif\r\n      flushList();\r\n      htmlParts.push(blockToHTML(child));\r\n    } else {\r\n      // défaut: flush et rendu enfants\r\n      flushList();\r\n      htmlParts.push(blockToHTML(child));\r\n    }\r\n  }\r\n\r\n  flushList();\r\n  return htmlParts.join(\"\");\r\n}\r\n\r\nfunction blockToHTML(block: Block, fontScale: number = 1): string {\r\n  switch (block.type) {\r\n    case \"header\": {\r\n      const text = block.content?.title || \"\";\r\n      return `<header class=\"cv-header\"><h1 class=\"cv-name\">${escapeHtml(text)}</h1></header>`;\r\n    }\r\n    case \"contact\": {\r\n      const c = block.content || {} as any;\r\n      const linkedin = c.linkedin ? `<a href=\"${escapeHtml(c.linkedin)}\" target=\"_blank\" rel=\"noopener\">linkedin</a>` : \"\";\r\n      const parts = [c.email || \"\", c.phone || \"\", c.address || \"\", linkedin].filter(Boolean).join(\" <span class=\\\"sep\\\">•</span> \");\r\n      return `<div class=\"cv-contact\">${parts}</div>`;\r\n    }\r\n    case \"text\": {\r\n      const raw = typeof block.content === \"string\" ? block.content : \"\";\r\n      const plain = raw.replace(/<[^>]*>/g, \"\");\r\n      const isSummary = plain.includes(\"Étudiant à IMT Atlantique\");\r\n      // si déjà préfixé par •, laisser la gestion au parent (subsection) sinon paragraphe simple\r\n      const isBullet = plain.trim().startsWith(\"•\");\r\n      if (isBullet) {\r\n        return `<p class=\"cv-text\">${raw}</p>`;\r\n      }\r\n      return `<p class=\"${isSummary ? \"cv-summary\" : \"cv-text\"}\">${raw}</p>`;\r\n    }\r\n    case \"divider\":\r\n      return `<hr class=\"cv-hr\"/>`;\r\n    case \"section\": {\r\n      const title = block.content?.title || \"\";\r\n      const children = (block.children || []).map((ch) => blockToHTML(ch, fontScale)).join(\"\");\r\n      return `<section class=\"cv-section\"><h2 class=\"cv-section-title\">${escapeHtml(title)}</h2>${children}</section>`;\r\n    }\r\n    case \"subsection\": {\r\n      const title = block.content?.title || \"\";\r\n      const subtitle = block.content?.subtitle || \"\";\r\n      const period = block.content?.period || \"\";\r\n      const head = `<div class=\"cv-subsection-head\"><div class=\"cv-subsection-left\"><div class=\"cv-subsection-title\">${escapeHtml(title)}${subtitle ? \" — <span class=\\\"cv-role\\\">\" + escapeHtml(subtitle) + \"</span>\" : \"\"}</div></div><div class=\"cv-period\">${escapeHtml(period)}</div></div>`;\r\n      const body = renderSubsectionChildren(block.children);\r\n      return `<div class=\"cv-subsection\">${head}${body}</div>`;\r\n    }\r\n    default:\r\n      return \"\";\r\n  }\r\n}\r\n\r\nexport default function blocksToHTML(blocks: Block[], fontScale: number = 1): string {\r\n  return blocks.map((b) => blockToHTML(b, fontScale)).join(\"\");\r\n}\r\n  "],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 135, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/halca/finance-type/my-cv-app/pages/api/generate-pdf.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from \"next\";\r\nimport puppeteer from \"puppeteer\";\r\nimport blocksToHTML from \"../../utils/blocksToHTML\";\r\nimport { Block } from \"../../utils/types\";\r\n\r\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\r\n  const blocks: Block[] = req.body.blocks;\r\n  const fontScale: number = req.body.fontScale || 1;\r\n\r\n  const html = `\r\n  <html>\r\n    <head>\r\n      <style>\r\n        @page { size: A4; margin: 15mm; }\r\n        body { font-family: 'Times New Roman', serif; }\r\n        .cv-page { width: 210mm; min-height: 297mm; box-sizing: border-box; font-size: ${10 * fontScale}pt; line-height: ${1.2 * fontScale}em; }\r\n        .cv-name { font-size: ${18 * fontScale}pt; margin: 0; padding: 0; font-weight: 700; }\r\n        .cv-header { text-align: center; margin-bottom: ${8 * fontScale}px; }\r\n        .cv-contact { text-align: center; margin-bottom: ${8 * fontScale}px; font-size: ${10 * fontScale}pt; }\r\n        .cv-contact .sep { margin: 0 4px; }\r\n        .cv-summary { text-align: center; margin-bottom: ${8 * fontScale}px; font-style: italic; font-size: ${10 * fontScale}pt; }\r\n        .cv-section { margin-top: ${8 * fontScale}px; }\r\n        .cv-section-title { font-size: ${12 * fontScale}pt; text-transform: uppercase; margin: 0 0 ${4 * fontScale}px 0; }\r\n        .cv-subsection { margin-bottom: ${6 * fontScale}px; }\r\n        .cv-subsection-head { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: ${2 * fontScale}px; }\r\n        .cv-subsection-title { font-size: ${10 * fontScale}pt; }\r\n        .cv-role { font-size: ${10 * fontScale}pt; }\r\n        .cv-period { font-style: italic; font-size: ${10 * fontScale}pt; }\r\n        .cv-text { margin: 0 0 ${2 * fontScale}px 0; font-size: ${10 * fontScale}pt; }\r\n        .cv-hr { border: 0; border-top: 0.2pt solid #000; margin: ${6 * fontScale}px 0; }\r\n        .cv-list { margin: 0 0 ${2 * fontScale}px 1em; padding-left: 0.9em; }\r\n        .cv-list li { margin: 0; padding: 0; list-style-type: disc; }\r\n      </style>\r\n    </head>\r\n    <body><div class=\"cv-page\" style=\"padding:15mm;\">${blocksToHTML(blocks, fontScale)}</div></body>\r\n  </html>`;\r\n\r\n  const browser = await puppeteer.launch({ args: [\"--no-sandbox\"] });\r\n  const page = await browser.newPage();\r\n  await page.setContent(html);\r\n\r\n  const pdf = await page.pdf({ format: \"A4\", printBackground: true });\r\n  await browser.close();\r\n\r\n  res.setHeader(\"Content-Type\", \"application/pdf\");\r\n  res.end(pdf);\r\n}\r\n"],"names":[],"mappings":";;;;AACA;AACA;;;;;;;AAGe,eAAe,QAAQ,GAAmB,EAAE,GAAoB;IAC7E,MAAM,SAAkB,IAAI,IAAI,CAAC,MAAM;IACvC,MAAM,YAAoB,IAAI,IAAI,CAAC,SAAS,IAAI;IAEhD,MAAM,OAAO,CAAC;;;;;;uFAMuE,EAAE,KAAK,UAAU,iBAAiB,EAAE,MAAM,UAAU;8BAC7G,EAAE,KAAK,UAAU;wDACS,EAAE,IAAI,UAAU;yDACf,EAAE,IAAI,UAAU,eAAe,EAAE,KAAK,UAAU;;yDAEhD,EAAE,IAAI,UAAU,mCAAmC,EAAE,KAAK,UAAU;kCAC3F,EAAE,IAAI,UAAU;uCACX,EAAE,KAAK,UAAU,2CAA2C,EAAE,IAAI,UAAU;wCAC3E,EAAE,IAAI,UAAU;qHAC6D,EAAE,IAAI,UAAU;0CAC3F,EAAE,KAAK,UAAU;8BAC7B,EAAE,KAAK,UAAU;oDACK,EAAE,KAAK,UAAU;+BACtC,EAAE,IAAI,UAAU,iBAAiB,EAAE,KAAK,UAAU;kEACf,EAAE,IAAI,UAAU;+BACnD,EAAE,IAAI,UAAU;;;;qDAIM,EAAE,IAAA,yHAAY,EAAC,QAAQ,WAAW;SAC9E,CAAC;IAER,MAAM,UAAU,MAAM,6HAAS,CAAC,MAAM,CAAC;QAAE,MAAM;YAAC;SAAe;IAAC;IAChE,MAAM,OAAO,MAAM,QAAQ,OAAO;IAClC,MAAM,KAAK,UAAU,CAAC;IAEtB,MAAM,MAAM,MAAM,KAAK,GAAG,CAAC;QAAE,QAAQ;QAAM,iBAAiB;IAAK;IACjE,MAAM,QAAQ,KAAK;IAEnB,IAAI,SAAS,CAAC,gBAAgB;IAC9B,IAAI,GAAG,CAAC;AACV","debugId":null}}]
}